# prompt_generation.py
import pytz
from datetime import datetime

# âœ… í”„ë¡¬í”„íŠ¸ ìƒì„± í•¨ìˆ˜
def make_prompt_summarize(text: str) -> str:
    return f"ë‹¤ìŒ í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ê°„ë‹¨íˆ ìš”ì•½í•´ ì£¼ì„¸ìš”:\n{text}"

def make_prompt_ner(text: str) -> str:
    
    return f"""
    ë‹¤ìŒ ë¬¸ì¥ì—ì„œ ì£¼ìš” ê°œì²´ëª…ì„ ì¶”ì¶œí•˜ê³  `JSON` í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”.
    ìš©ì–¸ì„ keywordë¡œ ì¶”ì¶œí•  ë•ŒëŠ” ì›í˜•ìœ¼ë¡œ ì…ë ¥í•  ê²ƒ.
    ê° í•­ëª©ì´ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ `[]`ì„ ë°˜í™˜í•˜ì„¸ìš”.

    [ì¶œë ¥ ì˜ˆì‹œ]
    ë¬¸ì¥: "í™ê¸¸ë™ì€ ì„œìš¸ì—ì„œ ì—´ë¦° ì—°ë§ íšŒì‹ì— ì°¸ì„í–ˆë‹¤."
    ì¶œë ¥: {{ "keywords": ["í™ê¸¸ë™", "ì„œìš¸", "ì—°ë§ íšŒì‹", "íšŒì‹", "ì°¸ì„"] }}
    
    ë¬¸ì¥: "{text}"
    ì¶œë ¥:
    """

def make_prompt_timestamp(user_query: str) -> str:
    """
    ì‚¬ìš©ìì˜ ì…ë ¥ì—ì„œ ë‚ ì§œ ì •ë³´ë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì¶”ì¶œí•˜ë˜,  
    ë¬¸ì¥ì˜ ë§¥ë½ì—ì„œ ë‚ ì§œê°€ ê²€ìƒ‰ í•„í„°ë¡œ ì˜ë¯¸ê°€ ìˆì„ ë•Œë§Œ `"use_as_filter": true"`ë¥¼ ë°˜í™˜.
    """
    
    # í•œêµ­ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
    seoul_tz = pytz.timezone("Asia/Seoul")
    current_time = datetime.now(seoul_tz).strftime("%Y-%m-%d %H:%M:%S")
    print(f'ğŸ“Œ í˜„ì¬ ì‹œê°„: {current_time}')
    
    return f"""
    í˜„ì¬ ì‹œê°ì€ {current_time}ì´ì•¼.
    ì‚¬ìš©ìì˜ ì…ë ¥ì—ì„œ ë‚ ì§œ ê´€ë ¨ í‚¤ì›Œë“œê°€ ë¬¸ì¥ì˜ ë§¥ë½ì—ì„œ í•„ìˆ˜ì ì¸ì§€ íŒë‹¨í•˜ê³ ,  
    í•„ìš”í•œ ê²½ìš°ë§Œ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì„¸ìš”.  
    í˜„ì¬ ì‹œê°ì„ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰í•„í„°ë¡œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ì—°ì›”ì¼ ë°ì´í„°ë¥¼ ê³„ì‚°í•´ ì¤˜.
    
    ê²€ìƒ‰ í•„í„°ë¡œ ì´ìš©í•  ìˆ˜ ì—†ëŠ” ë¯¸ë˜ì— ëŒ€í•œ ë‚´ìš©ì´ë‚˜, ë‚ ì§œê°€ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤ë©´ `"use_as_filter": false"`ë¥¼ ë°˜í™˜í•˜ì„¸ìš”.

    âœ… ë‚ ì§œê°€ í•µì‹¬ì ì´ê³  RAGë¡œ ì“¸ ìˆ˜ ìˆëŠ” ê³¼ê±° í˜¹ì€ ê°€ê¹Œìš´ ê³¼ê±° ê²½ìš° â†’ `true` (ê²€ìƒ‰ í•„í„° ì ìš©)  
    âœ… ë‹¨ìˆœí•œ ë°°ê²½ ì •ë³´ ë˜ëŠ” íŠ¸ë Œë“œ ì–¸ê¸‰ ë˜ëŠ” ë¯¸ë˜ì— ëŒ€í•œ ì´ì•¼ê¸° â†’ `false` (ê²€ìƒ‰ í•„í„° ì œì™¸)  

    [ì¶œë ¥ ì˜ˆì‹œ]
    - "ì§€ë‚œì£¼ íƒ€ë¡œ ê²°ê³¼ ë‹¤ì‹œ ë³´ê³  ì‹¶ì–´." â†’ `{{"use_as_filter": true, "start_date": "2024-02-05", "end_date": "2024-02-11"}}`
    - "2023ë…„ 12ì›”ì— ìƒë‹´í•œ ìš´ì„¸ ê¸°ì–µë‚˜?" â†’ `{{"use_as_filter": true, "start_date": "2023-12-01", "end_date": "2023-12-31"}}`
    - "ì–´ì œ ë³¸ ì—°ì• ìš´ ë‹¤ì‹œ í™•ì¸í•˜ê³  ì‹¶ì–´ìš”." â†’ `{{"use_as_filter": true, "start_date": "2024-02-13", "end_date": "2024-02-13"}}`
    - "ì˜¬í•´ì˜ íƒ€ë¡œ íŠ¸ë Œë“œëŠ” ì–´ë–¤ê°€ìš”?" â†’ `{{"use_as_filter": false}}`
    - "íƒ€ë¡œ ë¦¬ë”©ì€ ì‘ë…„ì—ë„ ì¸ê¸°ê°€ ë§ì•˜ì–´." â†’ `{{"use_as_filter": false}}`
    - "ìš´ì„¸ë¥¼ ë³´ê³  ì‹¶ì–´ìš”." â†’ `{{"use_as_filter": false}}`
    - "ë‚´ì¼ì€ ì–´ë–¤ ìš´ì„¸ê°€ ê¸°ë‹¤ë¦¬ê³  ìˆë‹ˆ?" â†’ `{{"use_as_filter": false}}`

    [ì…ë ¥]
    "{user_query}"

    [ì¶œë ¥]
    """

def make_prompt_chat(context: str, user_input: str) -> str:
    return f"[Context]\n{context}\n\nUser input: {user_input}\n\nìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¹œì ˆí•˜ê³  ì •í™•í•œ ë‹µë³€ì„ í•´ì£¼ì„¸ìš”."
